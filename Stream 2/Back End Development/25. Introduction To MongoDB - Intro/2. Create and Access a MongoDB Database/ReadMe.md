### CREATE AND ACCESS A MONGODB DATABASE

Before we move into the next step of creating our own database, let’s see
exactly what a document oriented data-model is.

A typical document in MongoDB looks something like this:

{  
\_id: ObjectID('4bd9e8e17cefd644108961bb'),  
name: 'Vivek',  
class: '12th',  
subjects: ['physics', 'chemistry', 'math', 'english', 'computer'],  
address: {  
house_no: '12B',  
block: 'B',  
sector: 12,  
city: 'noida'  
},  
grade: [  
{  
exam: 'unit test 1',  
score: '60%'  
},  
{  
exam: 'unit test 2',  
score: '70%'  
}  
]  
}

The above document contains information of a student in the key-value pair. It
contains a unique **\_id** for the record, name and its value, class and its
value, subjects and its value in the form of array, address that contains its
value in the form of another in-document, and grade that contains its value in
the form of arrays of documents.

If we had to represent the same record in the Relational world, then we would
require at least three tables. One to store basic information like \_id, name,
class, and address, another to store subjects, and another one to store grades,
etc. But here we stored the whole relational information in one complete
document. This is how we manage the deficiency of joins and constraints in
MongoDB. In MongoDB we don’t have joins, but it’s up to us as the developers how
we design our schema to manage relations.

### INSERT DATA

As with nearly all database management systems, there is a core command line
interface (shell) to access the DBMS and a nice GUI-based admin tool use to make
life easier. Before we get to the latter, let’s look at creating and populating
a document database in using the MongoDB shell.

1.  Open up a Command Prompt/Terminal instance Navigate to your MongoDB bin
    folder. Then run the **mongo** command to open the shell.

   
To Access the mongo shell, you need to have your **mongod** process running. So
get mongod started, then open a new command line/Terminal window to work with
the shell.

In Windows it looks like below:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image17.png)

   
Mongo creates a test database by default.

1.   Next, copy the text below and paste it into the shell to create and
    populate a collection called **myFirstDB**. A collection is similar to a
    table in a relational database.

db.myFirstMDB.insert({  
first: 'john',  
last: 'lennon',  
dob: '09/10/1940',  
gender: 'm',  
hair_colour: 'brown',  
occupation: 'beatle',  
nationality: 'english'  
});  
db.myFirstMDB.insert({  
first: 'kate',  
last: 'bush',  
dob: '30/07/1958',  
gender: 'f',  
hair_colour: 'brown',  
occupation: 'singer',  
nationality: 'english'  
});  
db.myFirstMDB.insert({  
first: 'eve',  
last: 'ryan',  
dob: '19/09/1992',  
gender: 'f',  
hair_colour: 'pink',  
occupation: 'developer',  
nationality: 'irish'  
});  
db.myFirstMDB.insert({  
first: 'martha',  
last: 'fenton',  
dob: '15/05/1974',  
gender: 'f',  
hair_colour: 'brown',  
occupation: 'manager',  
nationality: 'irish'  
});  
db.myFirstMDB.insert({  
first: 'Neil',  
last: 'Hanslem',  
dob: '14/07/1983',  
gender: 'm',  
hair_colour: 'blonde',  
occupation: 'actor',  
nationality: 'english'  
});  
db.myFirstMDB.insert({  
first: 'Rocky',  
last: 'Persolm',  
dob: '19/12/1994',  
gender: 'f',  
hair_colour: 'black',  
occupation: 'activist',  
nationality: 'american'  
});

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image18.png)

We’ve just created a new database collection called **myFirstMDB** and inserted
6 records.

The last line tell us that a successful insert took place and also that the
inserted JSON objects were treated as a single document.

WriteResult({ "nInserted" : 1 })

### READ BACK DATA

Let’s verify that the database and the records were actually created by reading
the contents of the database. To do this, we invoke the **find()** function that
is available to all MongoDB databases.

Run the command below in the mongo shell:

db.myFirstMDB.find()

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image19.png)

We get all our records printed out to the console. Notice that Mongo gives each
record an **ObjectID** (similar to a primary key in a relational database). This
is auto generated by Mongo for you, if you don’t specify an **id** in
your **JSON** object.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image20.png)

### FILTER THROUGH RECORDS

The past command returned everything from the database; but as with relational
databases, we’d like to be able to target specific elements of a record such as
gender, nationality, etc.  Mongo let’s us do that pretty easily.

### SELECTORS

Selectors are to MongoDB as what clauses are to SQL.

[EXACT MATCH](http://lms.codeinstitute.net/course-status/#collapse_ijxnpn)

We want to find all records where the gender is female. Type the command below
into the mongo shell:

db.myFirstMDB.find({gender: 'f'});

In this case we get back 4 records that match our selection criteria.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image21.png)

Change the gender value to “**m**” and see what you get back.

[MULTIPLE CRITERIA](http://lms.codeinstitute.net/course-status/#collapse_m6ljct)

What if we want to find all the records that contain either females or people
from England? The syntax below will do that for us:

db.myFirstMDB.find({gender: 'f', \$or: [{nationality: 'english'}]});

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image22.png)

If we want to return all females that are Irish or American, we write the code
below:

db.myFirstMDB.find({gender: 'f', \$or: [{nationality: 'american'}, {nationality:
'irish'}]});

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image23.png)

[SORTING](http://lms.codeinstitute.net/course-status/#collapse_cnhplq)

Just like SQL, Mongo provides the means to sort through records. Not
surprisingly, it uses the **sort()** function. This function takes one of two
integer parameters to tell it which direction to sort in.

-   Ascending : 1

-   Descending: -1

db.myFirstMDB.find().sort({nationality: 1})

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image24.png)

[LIMITING DATA
RETURNED](http://lms.codeinstitute.net/course-status/#collapse_tklmeb)

If we have a lot of records and we want to restrict the number returned, we can
use the **limit()** function. Run the code below:

db.myFirstMDB.find({gender: 'f', \$or: [{nationality: 'irish'}, {nationality:
'english'}]}).limit(3);

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image25.png)

[UPDATING](http://lms.codeinstitute.net/course-status/#collapse_smuxkm)

As  you might expect, MongoDB  gives us the ability to update records as well as
cre. As we saw earlier, when using the **find** method and SQL queries, you need
to specify the criteria for the record that you want to modify, then the data in
that record that’s going to be modified.

Imagine we need to update all Irish people to have blue hair. We could try the
code below:

db.myFirstMDB.update({nationality: 'irish'}, {\$set: {hair_colour: 'blue'}});

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image26.png)

The feedback from mongo is that one record was modified.

Do a find to confirm and we can see that Eve Ryan was the only Irish person who
has had their hair color modified. That is because hers is the first matching
record found.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image27.png)

To update multiple records, we simply add an extra parameter called multi and
set it to true. Try it out below:

db.myFirstMDB.update({nationality: 'irish'}, {\$set:
{hair_colour:'blue'}},{multi:true});

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image28.png)

We can see that 2 records matched and were modified. Let’s verify.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image29.png)

We can see above that the 2 records that match the Irish nationality now have a
hair color of blue.

[DELETING](http://lms.codeinstitute.net/course-status/#collapse_dtgnks)

No prizes for guessing at this point that MongoDB provides full CRUD
functionality. Let’s see how we can delete a record.

We are going to remove Kate Bush from the collection, and here’s the syntax to
do it:

db.myFirstMDB.remove({first: 'kate', last: 'bush'});

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image30.png)

The feedback tells us that a single record has been removed. Again, let’s
verify.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image31.png)

The record has been deleted and Kate is no more.

As is the case with SQL, if we don’t specify a particular match criteria when
deleting records in MongoDB, all records in the collection will be deleted. Try
it and see, but don’t forget the curly braces **{}** passed as a parameter;
otherwise, you’ll get an error.

db.myFirstMDB.remove({});

And we get the following results:

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image32.png)

All remaining 5 records have been removed. Let’s verify.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image33.png)

 

### USING A MONGODB GUI TOOL

There are many great GUI based tools out there for interacting with MongoDB. One
in particular is called **Mongo Management Studio**.

![](http://codeinstitute.wpengine.com/wp-content/uploads/2015/11/1448201978_image34.png)

You can download it here:

<http://www.litixsoft.de/english/download/>

In order to play with it, you’ll need **mongod** running in your shell.

### ACCESSING MONGODB IN PYTHON

**PyMongo** is a Python distribution containing tools for working with
MongoDB and is the recommended way to work with MongoDB from Python.

pip install pymongo

 

[TEST A CONNECTION](http://lms.codeinstitute.net/course-status/#collapse_jmoigz)

Create a new python file. Add the code below:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
conn = mongo_connect()
db = conn['twitter_stream']
print db  # Database(MongoClient('localhost', 27017), u'twitter_stream')
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

Note that the database won’t show in Mongo Management Studio until we have added
some data.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
print db.collection_names()  # []
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[GET THE NAMES OF THE REGISTERED
DATABASES](http://lms.codeinstitute.net/course-status/#collapse_ldptve)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
conn = mongo_connect()
db = conn['twitter_stream']
print conn.database_names()  # [u'local', u'test']
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[ADD A DOCUMENT TO THE
DATABASE](http://lms.codeinstitute.net/course-status/#collapse_olnbdg)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
doc = {"name": "Code", "surname": "Institute", "twitter": "@codersinstitute"}
coll.insert(doc)
result = coll.find_one()
print result
# {u'twitter': u'@codersinstitute', u'_id': ObjectId('5629264db1bae125ac446ba5'), u'surname': u'Institute', u'name': u'Code'}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[ADD MULTIPLE DOCUMENTS TO THE
DATABASE](http://lms.codeinstitute.net/course-status/#collapse_xzgsyl)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
docs = [{"name": "Henry", "surname": "Moore", "twitter": "@henrymoore"},
       {"name": "Stephen", "surname": "Fry", "twitter": "@stephenfry"}]
coll.insert_many(docs)
results = coll.find()
print results #<pymongo.cursor.Cursor object at 0x02909C90>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[ITERATE THROUGH THE
CURSOR](http://lms.codeinstitute.net/course-status/#collapse_sy86pf)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
coll.drop()  # remove the collection
docs = [{"name": "Code", "surname": "Institute", "twitter": "@codersinstitute"},
       {"name": "Stephen", "surname": "Fry", "twitter": "@stephenfry"},
       {"name": "Code", "surname": "Institute", "twitter": "@codersinstitute"}]
coll.insert_many(docs)
results = coll.find()
for doc in results:
   print doc
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[FIND AN ELEMENT IN THE
CURSOR](http://lms.codeinstitute.net/course-status/#collapse_qcpaqx)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
coll.drop()  # remove the collection
docs = [{"name": "Code", "surname": "Institute", "twitter": "@codersinstitute"},
       {"name": "Stephen", "surname": "Fry", "twitter": "@stephenfry"},
       {"name": "Stephen", "surname": "Dedalus", "twitter": "@stephend"}]
coll.insert_many(docs)
results = coll.find({"name": "Stephen"})
for doc in results:
   print doc
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[GET COLUMN AND RECORD
COUNT](http://lms.codeinstitute.net/course-status/#collapse_553gpb)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
 
 
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
coll.drop()  # remove the collection
docs = [{"name": "Code", "surname": "Institute", "twitter": "@codersinstitute"},
       {"name": "Stephen", "surname": "Fry", "twitter": "@stephenfry"},
       {"name": "Stephen", "surname": "Dedalus", "twitter": "@stephend"}]
coll.insert_many(docs)
results = coll.find({"name": "Stephen"})
print results.count()  # 2
print coll.count()  # 3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[WORKING WITH
DATES](http://lms.codeinstitute.net/course-status/#collapse_l3ovxr)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import pymongo
import datetime
from datetime import timedelta
def mongo_connect():
   try:
       conn = pymongo.MongoClient()
       print "Mongo is connected!"
       return conn
   except pymongo.errors.ConnectionFailure, e:
       print "Could not connect to MongoDB: %s" % e
conn = mongo_connect()
db = conn['twitter_stream']
coll = db.my_collection
coll.drop()  # remove the collection to avoid duplicates when testing
docs = [{"name": "Code", "surname": "Institute", "twitter": "@codersinstitute",
        "date": datetime.datetime.utcnow()},
       {"name": "Stephen", "surname": "Fry", "twitter": "@stephenfry",
        "date": datetime.datetime.utcnow() - timedelta(days=2)},
       {"name": "Stephen", "surname": "Dedalus", "twitter": "@stephend",
        "date": datetime.datetime.utcnow() + timedelta(days=10)},
       {"name": "Armand", "surname": "Tanzarian", "twitter": "@armandt",
        "date": datetime.datetime.utcnow() - timedelta(days=10), "_id": "22"}]
coll.insert_many(docs)
date = datetime.datetime.utcnow()
for doc in coll.find({"date": {"$lt": date}}).sort("name"):  # see  also -  $lte, $gte, $ne
   print doc
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

[ADD TWITTER STREAMING
DATA](http://lms.codeinstitute.net/course-status/#collapse_fukqte)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
import json
import pymongo
from tweepy import Stream
from tweepy import OAuthHandler
from tweepy.streaming import StreamListener
 
CONSUMER_KEY = '123abc'
CONSUMER_SECRET = '123abc'
OAUTH_TOKEN = '123abc'
OAUTH_TOKEN_SECRET = '123abc'
 
keyword_list = ['france']  # track list
 
class MyStreamListener(StreamListener):
   def __init__(self, api=None):
       self.num_tweets = 0
       self.tweet_coll = None
 
   def mongo_connect(self):
       try:
           client = pymongo.MongoClient()
           print "Mongo is connected!"
           db = client.tech_tweetsDB
           self.tweet_coll = db.tweets  # collection
       except pymongo.errors.ConnectionFailure, e:
           print "Could not connect to MongoDB: %s" % e
 
   def on_data(self, data):
       try:
 
           # read in a tweet
           status = json.loads(data)
           print json.dumps(status, indent=4)
           # create a dict to filter our preferred tweet properties
           tweet = {}
           tweet["text"] = status['text'].encode('utf-8')
           tweet['screen_name'] = status['user']['screen_name']
           tweet['followers_count'] = status['user']['followers_count']
           tweet['friends_count'] = status['user']['friends_count']
           tweet['favorite_count'] = status['favorite_count']
           tweet['retweet_count'] = status['retweet_count']
           # check if media url included in status
           print status.get('entities').get("media")
           if status.get('entities').get("media"):
               print status.get('entities').get("media")
               media = status['entities']["media"]
               tweet['media'] = media[0]["display_url"]
           else:
               tweet['media'] = None
 
           tweet['lang'] = status['user']['lang']
           tweet['location'] = status['user']['location']
 
           self.num_tweets += 1
           print  self.num_tweets
           if self.num_tweets < 10:
               # Insert tweet into the collection
               self.tweet_coll.insert(tweet)
               return True
           else:
               return False
 
           return True
       except BaseException as e:
           print "Failed on_data: %s" % str(e)
       return True
 
   def on_error(self, status):
       print status
       return True
 
 
# authenticate with the API
auth = OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)
auth.set_access_token(OAUTH_TOKEN, OAUTH_TOKEN_SECRET)
 
# create a StreamListener instance
stream = MyStreamListener()
# connect to the db
stream.mongo_connect()
 
twitter_stream = Stream(auth, stream)
# invoke the filter method to pull in the data
twitter_stream.filter(track=keyword_list)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

### SUMMARY

In this lesson we learned:

-   MongoDB is a document oriented database that stores its data in a format
    very similar to JSON called BSON.

-   How to install and configure MongoDB.

-   How to create a collection that is similar to the concept of a table in
    relational databases.

-   MongoDB has similar CRUD capabilities to SQL based systems and we explored
    the basic crud commands.

-   How to use GUI tool to access MongoDB.

-   How to use MongoDB in Python

 

### CHALLENGE

 

Explore the database access commands in more detail in the links below. Try and
execute the shown examples.

-   <https://docs.mongodb.org/manual/tutorial/query-documents/>

-   <https://docs.mongodb.org/manual/tutorial/insert-documents/>

-   <https://docs.mongodb.org/manual/tutorial/modify-documents/>

-   <https://docs.mongodb.org/manual/tutorial/remove-documents/>
